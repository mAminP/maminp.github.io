/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{731:function(t,n,e){"use strict";e.r(n);var r=e(52),o=(e(176),e(174),e(534)),c=(e(536),e(196)),d=e(0);function h(t,n,e,r){return new(e||(e=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,a)}u((r=r.apply(t,n||[])).next())}))}function l(t,n){var e,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(t,s)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function f(t){return[Math.abs(t.endPoint[0]-t.startPoint[0]),Math.abs(t.endPoint[1]-t.startPoint[1])]}function m(t){return[t.startPoint[0]+(t.endPoint[0]-t.startPoint[0])/2,t.startPoint[1]+(t.endPoint[1]-t.startPoint[1])/2]}function v(t,n){void 0===n&&(n=1.5);var e=m(t),r=f(t),o=[n*r[0]/2,n*r[1]/2];return{startPoint:[e[0]-o[0],e[1]-o[1]],endPoint:[e[0]+o[0],e[1]+o[1]],palmLandmarks:t.palmLandmarks}}function O(t){var n=m(t),e=f(t),r=Math.max.apply(Math,e)/2;return{startPoint:[n[0]-r,n[1]-r],endPoint:[n[0]+r,n[1]+r],palmLandmarks:t.palmLandmarks}}function P(t,n){var e=[t.endPoint[0]-t.startPoint[0],t.endPoint[1]-t.startPoint[1]],r=[e[0]*n[0],e[1]*n[1]];return{startPoint:[t.startPoint[0]+r[0],t.startPoint[1]+r[1]],endPoint:[t.endPoint[0]+r[0],t.endPoint[1]+r[1]],palmLandmarks:t.palmLandmarks}}var j=function(){function t(t,n,e,i,s,a){this.model=t,this.width=n,this.height=e,this.iouThreshold=s,this.scoreThreshold=a,this.anchors=i.map((function(t){return[t.x_center,t.y_center]})),this.anchorsTensor=Object(d.tensor2d)(this.anchors),this.inputSizeTensor=Object(d.tensor1d)([n,e]),this.doubleInputSizeTensor=Object(d.tensor1d)([2*n,2*e])}return t.prototype.normalizeBoxes=function(t){var n=this;return Object(d.tidy)((function(){var e=Object(d.slice)(t,[0,0],[-1,2]),r=Object(d.slice)(t,[0,2],[-1,2]),o=Object(d.add)(Object(d.div)(e,n.inputSizeTensor),n.anchorsTensor),c=Object(d.div)(r,n.doubleInputSizeTensor),h=Object(d.mul)(Object(d.sub)(o,c),n.inputSizeTensor),l=Object(d.mul)(Object(d.add)(o,c),n.inputSizeTensor);return Object(d.concat2d)([h,l],1)}))},t.prototype.normalizeLandmarks=function(t,n){var e=this;return Object(d.tidy)((function(){var r=Object(d.add)(Object(d.div)(Object(d.reshape)(t,[-1,7,2]),e.inputSizeTensor),e.anchors[n]);return Object(d.mul)(r,e.inputSizeTensor)}))},t.prototype.getBoundingBoxes=function(t){return h(this,void 0,void 0,(function(){var n,e,s,a,r,o,c,g,b,h,f,m,v,O,P,j=this;return l(this,(function(l){switch(l.label){case 0:return n=Object(d.tidy)((function(){return Object(d.mul)(Object(d.sub)(t,.5),2)})),"webgl"===Object(d.getBackend)()?(s=Object(d.env)().get("WEBGL_PACK_DEPTHWISECONV"),Object(d.env)().set("WEBGL_PACK_DEPTHWISECONV",!0),e=this.model.predict(n),Object(d.env)().set("WEBGL_PACK_DEPTHWISECONV",s)):e=this.model.predict(n),a=Object(d.squeeze)(e),r=Object(d.tidy)((function(){return Object(d.squeeze)(Object(d.sigmoid)(Object(d.slice)(a,[0,0],[-1,1])))})),o=Object(d.slice)(a,[0,1],[-1,4]),c=this.normalizeBoxes(o),g=console.warn,console.warn=function(){},b=d.image.nonMaxSuppression(c,r,1,this.iouThreshold,this.scoreThreshold),console.warn=g,[4,b.array()];case 1:return h=l.sent(),f=[n,e,b,a,c,o,r],0===h.length?(f.forEach((function(t){return t.dispose()})),[2,null]):(m=h[0],v=Object(d.slice)(c,[m,0],[1,-1]),O=Object(d.slice)(a,[m,5],[1,14]),P=Object(d.tidy)((function(){return Object(d.reshape)(j.normalizeLandmarks(O,m),[-1,2])})),f.push(O),f.forEach((function(t){return t.dispose()})),[2,{boxes:v,palmLandmarks:P}])}}))}))},t.prototype.estimateHandBounds=function(t){return h(this,void 0,void 0,(function(){var n,e,i,s,u,r,o,c,h=this;return l(this,(function(l){switch(l.label){case 0:return n=t.shape[1],e=t.shape[2],i=Object(d.tidy)((function(){return Object(d.div)(d.image.resizeBilinear(t,[h.width,h.height]),255)})),[4,this.getBoundingBoxes(i)];case 1:return null===(s=l.sent())?(i.dispose(),[2,null]):(u=s.boxes.arraySync(),r=u[0].slice(0,2),o=u[0].slice(2,4),c=s.palmLandmarks.arraySync(),i.dispose(),s.boxes.dispose(),s.palmLandmarks.dispose(),[2,(p={startPoint:r,endPoint:o,palmLandmarks:c},f=[e/this.width,n/this.height],{startPoint:[p.startPoint[0]*f[0],p.startPoint[1]*f[1]],endPoint:[p.endPoint[0]*f[0],p.endPoint[1]*f[1]],palmLandmarks:p.palmLandmarks.map((function(t){return[t[0]*f[0],t[1]*f[1]]}))})])}var p,f}))}))},t}(),x={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};var w=function(t,n){return[[1,0,t],[0,1,n],[0,0,1]]};function y(t,n){for(var e=0,r=0;r<t.length;r++)e+=t[r]*n[r];return e}function k(t,n){for(var e=[],r=0;r<t.length;r++)e.push(t[r][n]);return e}function B(t,n){for(var e=[],r=t.length,o=0;o<r;o++){e.push([]);for(var i=0;i<r;i++)e[o].push(y(t[o],k(n,i)))}return e}function I(t,n){var e=Math.cos(t),r=Math.sin(t),o=[[e,-r,0],[r,e,0],[0,0,1]],i=B(w(n[0],n[1]),o);return B(i,w(-n[0],-n[1]))}function L(t,n){return[y(t,n[0]),y(t,n[1])]}var C=[0,-.4],M=[0,-.1],H=[0,5,9,13,17,1,2],T=function(){function t(t,n,e,r,o,i){this.boundingBoxDetector=t,this.meshDetector=n,this.meshWidth=e,this.meshHeight=r,this.maxContinuousChecks=o,this.detectionConfidence=i,this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.maxHandsNumber=1}return t.prototype.getBoxForPalmLandmarks=function(t,n){var e=t.map((function(t){return L(t.concat([1]),n)}));return v(O(P(this.calculateLandmarksBoundingBox(e),C)),3)},t.prototype.getBoxForHandLandmarks=function(t){for(var n=v(O(P(this.calculateLandmarksBoundingBox(t),M)),1.65),e=[],r=0;r<H.length;r++)e.push(t[H[r]].slice(0,2));return n.palmLandmarks=e,n},t.prototype.transformRawCoords=function(t,n,e,r){var o,i,s,a,u=this,c=f(n),d=[c[0]/this.meshWidth,c[1]/this.meshHeight],h=t.map((function(t){return[d[0]*(t[0]-u.meshWidth/2),d[1]*(t[1]-u.meshHeight/2),t[2]]})),l=I(e,[0,0]),v=h.map((function(t){return L(t,l).concat([t[2]])})),p=(i=[[(o=r)[0][0],o[1][0]],[o[0][1],o[1][1]]],s=[o[0][2],o[1][2]],a=[-y(i[0],s),-y(i[1],s)],[i[0].concat(a[0]),i[1].concat(a[1]),[0,0,1]]),O=m(n).concat([1]),P=[y(O,p[0]),y(O,p[1])];return v.map((function(t){return[t[0]+P[0],t[1]+P[1],t[2]]}))},t.prototype.estimateHand=function(t){return h(this,void 0,void 0,(function(){var n,e,r,i,s,u,o,c,p,h,f,v,g,b,O,P,j,x,w,y;return l(this,(function(l){switch(l.label){case 0:return!0!==(n=this.shouldUpdateRegionsOfInterest())?[3,2]:[4,this.boundingBoxDetector.estimateHandBounds(t)];case 1:return null===(e=l.sent())?(t.dispose(),this.regionsOfInterest=[],[2,null]):(this.updateRegionsOfInterest(e,!0),this.runsWithoutHandDetector=0,[3,3]);case 2:this.runsWithoutHandDetector++,l.label=3;case 3:return r=this.regionsOfInterest[0],i=function(t,n){var e;return(e=Math.PI/2-Math.atan2(-(n[1]-t[1]),n[0]-t[0]))-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}(r.palmLandmarks[0],r.palmLandmarks[2]),s=m(r),u=[s[0]/t.shape[2],s[1]/t.shape[1]],o=d.image.rotateWithOffset(t,i,0,u),c=I(-i,s),p=!0===n?this.getBoxForPalmLandmarks(r.palmLandmarks,c):r,h=function(t,n,e){var r=n.shape[1],i=n.shape[2],s=[[t.startPoint[1]/r,t.startPoint[0]/i,t.endPoint[1]/r,t.endPoint[0]/i]];return d.image.cropAndResize(n,s,[0],e)}(p,o,[this.meshWidth,this.meshHeight]),f=Object(d.div)(h,255),h.dispose(),o.dispose(),"webgl"===Object(d.getBackend)()?(g=Object(d.env)().get("WEBGL_PACK_DEPTHWISECONV"),Object(d.env)().set("WEBGL_PACK_DEPTHWISECONV",!0),v=this.meshDetector.predict(f),Object(d.env)().set("WEBGL_PACK_DEPTHWISECONV",g)):v=this.meshDetector.predict(f),b=v[0],O=v[1],f.dispose(),P=b.dataSync()[0],b.dispose(),P<this.detectionConfidence?(O.dispose(),this.regionsOfInterest=[],[2,null]):(j=Object(d.reshape)(O,[-1,3]),x=j.arraySync(),O.dispose(),j.dispose(),w=this.transformRawCoords(x,p,i,c),y=this.getBoxForHandLandmarks(w),this.updateRegionsOfInterest(y,!1),[2,{landmarks:w,handInViewConfidence:P,boundingBox:{topLeft:y.startPoint,bottomRight:y.endPoint}}])}}))}))},t.prototype.calculateLandmarksBoundingBox=function(t){var n=t.map((function(t){return t[0]})),e=t.map((function(t){return t[1]}));return{startPoint:[Math.min.apply(Math,n),Math.min.apply(Math,e)],endPoint:[Math.max.apply(Math,n),Math.max.apply(Math,e)]}},t.prototype.updateRegionsOfInterest=function(t,n){if(n)this.regionsOfInterest=[t];else{var e=this.regionsOfInterest[0],r=0;if(null!=e&&null!=e.startPoint){var o=t.startPoint,i=o[0],s=o[1],a=t.endPoint,u=a[0],c=a[1],d=e.startPoint,h=d[0],l=d[1],f=e.endPoint,p=f[0],m=f[1],v=Math.max(i,h),O=Math.max(s,l),g=(Math.min(u,p)-v)*(Math.min(c,m)-O);r=g/((u-i)*(c-s)+(p-h)*(m-s)-g)}this.regionsOfInterest[0]=r>.8?e:t}},t.prototype.shouldUpdateRegionsOfInterest=function(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks},t}();function E(){return h(this,void 0,void 0,(function(){return l(this,(function(t){return[2,Object(c.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})]}))}))}function W(){return h(this,void 0,void 0,(function(){return l(this,(function(t){return[2,Object(c.loadGraphModel)("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})]}))}))}function _(){return h(this,void 0,void 0,(function(){return l(this,(function(t){return[2,d.util.fetch("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then((function(t){return t.json()}))]}))}))}function S(t){var n=void 0===t?{}:t,e=n.maxContinuousChecks,r=void 0===e?1/0:e,o=n.detectionConfidence,i=void 0===o?.8:o,s=n.iouThreshold,a=void 0===s?.3:s,u=n.scoreThreshold,c=void 0===u?.5:u;return h(this,void 0,void 0,(function(){var t,n,e,o,s,u;return l(this,(function(d){switch(d.label){case 0:return[4,Promise.all([_(),E(),W()])];case 1:return t=d.sent(),n=t[0],e=t[1],o=t[2],s=new j(e,256,256,n,a,c),u=new T(s,o,256,256,r,i),[2,new D(u)]}}))}))}var D=function(){function t(t){this.pipeline=t}return t.getAnnotations=function(){return x},t.prototype.estimateHands=function(t,n){return void 0===n&&(n=!1),h(this,void 0,void 0,(function(){var e,r,i,s,a,u,o,c,h;return l(this,(function(l){switch(l.label){case 0:return e=function(t){return t instanceof d.Tensor?[t.shape[0],t.shape[1]]:[t.height,t.width]}(t),r=e[1],i=Object(d.tidy)((function(){return t instanceof d.Tensor||(t=d.browser.fromPixels(t)),Object(d.expandDims)(Object(d.cast)(t,"float32"))})),[4,this.pipeline.estimateHand(i)];case 1:if(s=l.sent(),i.dispose(),null===s)return[2,[]];for(a=s,!0===n&&(a=function(t,n){var e=t.handInViewConfidence,r=t.landmarks,o=t.boundingBox;return{handInViewConfidence:e,landmarks:r.map((function(t){return[n-1-t[0],t[1],t[2]]})),boundingBox:{topLeft:[n-1-o.topLeft[0],o.topLeft[1]],bottomRight:[n-1-o.bottomRight[0],o.bottomRight[1]]}}}(s,r)),u={},o=0,c=Object.keys(x);o<c.length;o++)h=c[o],u[h]=x[h].map((function(t){return a.landmarks[t]}));return[2,[{handInViewConfidence:a.handInViewConfidence,boundingBox:a.boundingBox,landmarks:a.landmarks,annotations:u}]]}}))}))},t}(),z=(e(268),e(468)),R={components:{CenterEl:o.default},data:function(){return{video:void 0,camvas:void 0,canvas:void 0,camvas_ctx:void 0,canvas_ctx:void 0,constraints:{video:{facingMode:"user"}}}},mounted:function(){this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.camvas=document.getElementById("camvas"),this.canvas=document.getElementById("canvas"),this.camvas_ctx=this.camvas.getContext("2d"),this.canvas_ctx=this.canvas.getContext("2d"),this.run()},methods:{findHand:function(t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.video||4!==n.video.readyState){e.next=6;break}return e.next=3,t.estimateHands(n.camvas);case 3:r=e.sent,Object(z.a)(r,n.canvas_ctx,n.$nuxt),setTimeout((function(){n.findHand(t)}),100);case 6:case"end":return e.stop()}}),e)})))()},hasGetUserMedia:function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},drawImge:function(){var t=this,n=this.video,e=n.videoHeight,r=n.videoWidth,o=window.innerWidth/r;this.camvas.width=r*o,this.canvas.width=r*o,this.camvas.height=e*o,this.canvas.height=e*o,this.camvas_ctx.drawImage(this.video,0,0,this.camvas.width,this.camvas.height),setTimeout((function(){t.drawImge()}),0)},run:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var e,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.hasGetUserMedia()){n.next=12;break}return n.next=3,navigator.mediaDevices.getUserMedia(t.constraints);case 3:return e=n.sent,t.video.srcObject=e,n.next=7,S();case 7:r=n.sent,t.drawImge(),t.findHand(r),n.next=13;break;case 12:alert("getUserMedia() is not supported by your browser");case 13:case"end":return n.stop()}}),n)})))()}}},G=e(108),component=Object(G.a)(R,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"e"},[e("center-el",[e("canvas",{attrs:{id:"camvas"}})]),t._v(" "),e("center-el",[e("canvas",{attrs:{id:"canvas"}})])],1)}),[],!1,null,null,null);n.default=component.exports;installComponents(component,{CenterEl:e(534).default})}}]);